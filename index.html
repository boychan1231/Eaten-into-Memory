<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eaten into Memory</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="game-wrapper">
    <header>
		<div class="tab-nav">
            <button class="tab-btn active" data-target="game-content">遊戲</button>
                <button class="tab-btn" data-target="rules-content">規則</button>
            <button class="tab-btn" data-target="settings-content">設定</button>
        </div>
		
        <div class="game-status">
			<button id="start-game-btn" class="start-game-btn">開始新遊戲</button>
        </div>
    </header>

    <div class="tab-wrapper">
        <div id="game-content" class="tab-content active-tab">  
            <div class="main-area">
                <div class="log-section">
					<h3>📜 遊戲日誌</h3>
					<div id="game-log-container">
						<ul id="log-list">
						<li>點擊「開始新遊戲」，然後點擊「下一回合」翻開小時卡</li>
						</ul>
					</div>
					<div id="evolution-progress-area" class="progress-area"></div>
				</div>
                <div class="clock-section">
                    <div id="clock-face">
						<img src="clock-bg.png" class="clock-bg-img" alt="鐘面">
						<svg id="connection-lines" class="connection-lines-svg"></svg>
                        <div class="clock-center"></div>
                    </div>
                </div>

				<details id="side-panel-details" class="side-panel-group" open>
					<summary class="side-panel-summary">資訊面板</summary>
					<div id="deck-info" class="log-side-info no-click">
						<div class="info-block">
							<div class="deck-title">小時卡庫</div>
							<div class="deck-count" id="deck-count-num">--</div>
						</div>	
						
						<div class="info-divider"></div>	
						
						<div class="info-block">
							<div class="deck-title">遊戲輪次</div>
							<div class="deck-count" id="game-round-num">--</div>
						</div>
						
						<div class="info-divider"></div>
						
						<div class="info-block">
							<div class="deck-title">當前回合</div>
							<div class="deck-count" id="round-count-num">--</div>
						</div>
					</div>
					
					<div class="panel-switcher">
						<button id="btn-show-played" class="switch-btn active" type="button">本回合</button>
						<button id="btn-show-history" class="switch-btn" type="button">歷史</button>
						<button id="btn-show-score" class="switch-btn" type="button">積分</button>
					</div>
					
					<div id="played-cards-panel" class="log-side-info">
						<div class="deck-title panel-title-highlight">本回合出牌</div>
						<div id="played-cards-list"></div>
					</div>
					
					<div id="score-panel" class="log-side-info score-panel">
						<div class="deck-title panel-title-highlight">🏆 積分</div>
						<div id="score-list"></div>
					</div>
					
					<div id="player-history-panel" class="log-side-info history-panel">
						<div class="deck-title panel-title-highlight">各角色出牌記錄</div>
						<div id="player-history-list"></div>
					</div>

				</details>
                
			</div>

                <div id="human-player-area" class="human-area">
                        
                    <div class="human-top-bar">
                        <div class="human-stats-row">
							<h4 id="human-role-display">您是：--</h4>
                            <div>手牌：<span id="h-hand-count">0</span></div>
                            <div class="resource-chip resource-chip--mana">
                                <span class="resource-chip__icon icon-mana-css" aria-hidden="true"></span>
                                Mana：<span id="h-mana">0</span>
                            </div>
                            <div class="resource-chip resource-chip--gear">
                                <span class="resource-chip__icon icon-gear-css" aria-hidden="true"></span>
                                齒輪：<span id="h-gear">0</span>
                            </div>
                            <div class="resource-chip resource-chip--shield">
                                <span class="resource-chip__icon icon-shield-css" aria-hidden="true"></span>
                                護盾: <span id="h-dice">--</span>
                            </div>
                            <div>位置: <span id="h-pos">--</span></div>
                            <div>收集小時卡: 
								<span id="h-hour">0</span>
								<button id="btn-view-collection" class="icon-btn" title="查看已收集卡片" aria-label="查看已收集卡片">🔍</button>
							</div>
                        </div>
                    </div>

                    <div class="human-tabs">
                        <div class="human-tab-panels">
                            <div id="human-tab-hand" class="human-tab-panel active">
                                <div class="human-play-row">
                                <div id="human-hand" class="hand-display"></div>
								
                                <div class="info-divider"></div>    
								
                                    <div id="human-controls" class="hand-controls">
										<div id="action-hint" class="action-hint" role="status" aria-live="polite"></div>
                                        <button id="confirm-move-btn" disabled>確認出牌</button>
                                        <button id="next-step-btn" disabled>下一回合</button>
                                    </div>
                                </div>
                            </div>
                        </div> 
					</div>
				</div> 
				
				<div id="players-section" class="players-grid">
                    <div class="player-card placeholder">
                        <p>等待遊戲開始...</p>
                    </div>
                </div>
				
				

            </div> 
			
			<div id="rules-content" class="tab-content">
				<h1>E<del>tched</del>aten into Memory</h1>
                <h3>📜 遊戲規則簡介</h3>

                <h4>🎴 卡牌種類</h4>
                <ul>
                    <li><strong>齒輪卡 (生命/Mana)：</strong>代表角色的生命值與能量上限。歸零時角色將被「驅逐」。</li>
                    <li><strong>分鐘卡 (1-60)：</strong>手牌。數值越大，回合結算時越優先行動。</li>
                    <li><strong>小時卡 (1-12)：</strong>分為少年、青年、中年三種時代。每局依照特定組合在三個時代中分配<strong>「珍貴(★)」</strong>小時卡。</li>
                </ul>

                <h4>🔄 回合流程</h4>
                <ol>
                    <li><strong>抽卡：</strong>每回合抽出 2 張小時卡。</li>
                    <li><strong>出牌：</strong>所有玩家打出 1 張分鐘卡 (數字大者先行動)。</li>
                    <li><strong>移動與收集：</strong>
                        <ul>
                            <li>依順序選擇場上的小時卡，並移動到該數字的位置。</li>
                            <li><strong>幼體時魔：</strong>可將卡片收為己有（用於進化）。</li>
                            <li><strong>其他角色：</strong>卡片將留在此鐘面位置上（堆疊）。</li>
                        </ul>
                    </li>
                    <li><strong>審判 (扣除齒輪)：</strong>結算後，位置最接近 12 (數值最大) 的角色受到懲罰，扣除 1 齒輪。</li>
                </ol>

                <h4>🧬 進化機制 (時魔專屬)</h4>
                <p>幼體時魔收集到指定條件的小時卡後可成長為時、分、秒三種形態。</p>
                <ul>
                    <li><strong>久遠一生：</strong>3 張不同時代 + 當中至少 1 張珍貴。</li>
                    <li><strong>命途節錄：</strong>4 張不同數字 + 當中至少 1 張珍貴。</li>
                    <li><strong>漫長生涯：</strong>5 張任意卡 + 當中至少 2 張珍貴。</li>
                    <li><strong>銘記珍重：</strong>3 張珍貴。</li>					
                </ul>

                <h4>⚔ 角色能力</h4>
                <ul>
                    <li><strong>幼體時魔：</strong>
                        <br>🛡️ <strong>防禦：</strong>受罰時，若 Mana ≥ 3，可消耗所有 Mana 抵擋傷害。
                    </li>
                    <li><strong>時之惡 (Boss)：</strong>
                        <br>😈 <strong>主動 2 Mana：</strong>惡之牽引 - 本回合改為懲罰「距離最近」者。
                        <br>🚫 <strong>主動 4 Mana：</strong>封鎖- 封印本回合所有時魔能力 。
                        <br>⚠️ 被動懲罰：若連續 2 輪沒有時魔被逐出，時之惡將自損 1 齒輪。
                    </li>
					
                    <li><strong>時針：</strong>
                        <br>👁️ <strong>被動：</strong>預知牌庫頂的小時卡。
						<br>⚡ <strong>主動 1 Mana：</strong>將牌庫頂的卡移至底部。
                        <br><span class="rules-subhint">└ 可再消耗 <strong>2 Mana</strong> 再次執行 (每回合 1 次)。</span>
                    </li>
                    <li><strong>分針：</strong>
                        <br>⚡ <strong>主動 2 Mana：</strong>取得任意小時卡後，可順/逆時針移動下一個有小時卡的格子。</li>
                    <li><strong>秒針：</strong>
                        <br>⚡ <strong>主動 3 Mana：</strong>出牌時蓋放 2 張，看過對手出牌後再二選一。
                    </li>
                </ul>

                <h4>🏁 勝負判定</h4>
				<ul>
					<li><strong>受詛者：</strong>遊戲結束時，鐘面上須保留 <strong>12 張</strong> 珍貴小時卡，否則落敗（除非觸發「不可能的救贖」）。</li>
					<li><strong>時之惡：</strong>若所有時魔都曾被驅逐，時之惡勝利。</li>	
					<li><strong>不可能的救贖：</strong>時之惡的齒輪耗盡被驅逐時，時魔立即取勝。</li>

					<li><strong>計分：</strong>
						<ul>
							<li>主要分數：每輪結束時剩餘齒輪數。</li>
							<li>時魔進化加分：已進化的時魔 (時/分/秒針) 在遊戲結束時 +3 分。</li>
							<li>受詛者加分：若提早在第 2/ 3/ 4 輪達成 12 張珍貴小時卡目標，分別獲得 <strong>9 / 5 / 2</strong> 分。</li>
						</ul>
					</li>
				</ul>
            </div>
		
			<div id="settings-content" class="tab-content">
			<h3>⚙️ 遊戲設定</h3>
			
		<div class="setting-item">
			<h4>日誌速度</h4>
			<div class="settings-range-row">
				<input type="range" id="log-speed-slider" min="0" max="1000" step="50" value="360" class="log-speed-slider">
				<span id="log-speed-value" class="log-speed-value">360 ms</span>
			</div>
			<p class="setting-note">調整遊戲訊息顯示的快慢。設為 0 可瞬間顯示。</p>
		</div>

        <hr class="settings-divider">

		<div class="setting-item">
			<h4>日誌保留量</h4>
			<div class="settings-range-row">
				<input type="range" id="log-retention-slider" min="50" max=1000" step="50" value="200" class="log-speed-slider">
				<span id="log-retention-value" class="log-speed-value">200 則</span>
			</div>
			<p class="setting-note">限制日誌清單保留的最大數量，避免長局造成 DOM 過大。</p>
		</div>

		<hr class="settings-divider">
		
		<div class="setting-item">
            <h4>手牌排列順序</h4>
            <div class="settings-radio-group">
                <label class="radio-label">
                    <input type="radio" name="hand-sort" value="asc">
                    <span class="radio-custom"></span>
                    <span>由小到大 (1 ➝ 60)</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="hand-sort" value="desc">
                    <span class="radio-custom"></span>
                    <span>由大到小 (60 ➝ 1)</span>
                </label>
            </div>
            <p class="setting-note">調整下方手牌區域的卡片顯示順序。</p>
        </div>

		<hr class="settings-divider">

		<div class="setting-item">
			<h3>設定選項</h3>
			
				<label class="toggle-switch toggle-switch-spaced">
				<input type="checkbox" id="ability-toggle" checked>
				<span class="slider"></span>
				<span>啟用特殊能力 </span>
			</label>

			<label class="toggle-switch">
				<input type="checkbox" id="test-toggle">
				<span class="slider"></span>
				<span>測試模式</span>
			</label>
			    <div class="setting-hint">
                開啟後人類玩家第 1 輪起始手牌固定為 1,2,3,4,5,12,36,56,57,58,59,60。其他角色照常隨機分配（會先從牌庫移除上述卡）。
                </div>
		</div>

		<hr class="settings-divider">

			<div class="setting-item">
				<h4>除錯資訊</h4>
				<p class="setting-muted">
					Build Ver: 2025.01.27<br>
					Core: game.js / UI: ui.js
					2026 01 14：鐘面回合數指示浮標變成指示玩家位置
				</p>
			</div>
		</div>
			
		<div id="role-choice-overlay" class="modal-overlay hidden">
			<div class="modal">
			<span id="role-choice-close-btn" class="modal-close-btn">&times;</span>
			<h2>選擇角色</h2>
				<div class="modal-actions">
				<button id="role-choice-timeDemon" class="primary" type="button">時魔</button>
				<button id="role-choice-sin" type="button">時之惡</button>
				<button id="role-choice-scz" type="button">受詛者</button>
				</div>
			</div>
		</div>

		<div id="game-mode-overlay" class="modal-overlay hidden" aria-hidden="true">
			<div class="modal">
				<span id="game-mode-close-btn" class="modal-close-btn">&times;</span>
				<h2>開始新遊戲</h2>
				<div class="modal-section">
					<h3>遊戲模式</h3>
					<div class="settings-button-group" data-selection-group="start-game-mode" role="radiogroup" aria-label="遊戲模式">
						<button class="selection-btn is-selected" type="button" data-value="5P" role="radio" aria-checked="true" aria-pressed="true">5P 模式 (原設定)</button>
						<button class="selection-btn" type="button" data-value="3P" role="radio" aria-checked="false" aria-pressed="false">3P 模式</button>
					</div>
					<p id="start-mode-note" class="setting-note">3P 模式僅有時魔玩家，遊戲輪數為 3 輪，且不使用珍貴小時卡。</p>
				</div>
				<div class="modal-section">
					<h3>時魔身份</h3>
					<div class="settings-button-group" data-selection-group="start-time-demon-role" role="radiogroup" aria-label="時魔身份">
						<button class="selection-btn is-selected" type="button" data-value="時針" role="radio" aria-checked="true" aria-pressed="true">時針</button>
						<button class="selection-btn" type="button" data-value="分針" role="radio" aria-checked="false" aria-pressed="false">分針</button>
						<button class="selection-btn" type="button" data-value="秒針" role="radio" aria-checked="false" aria-pressed="false">秒針</button>
					</div>
					<p class="setting-note">若選擇 3P 模式，將以此身份開始遊戲。</p>
				</div>
				<div class="modal-actions">
					<button id="game-mode-confirm" class="primary" type="button">開始遊戲</button>
				</div>
			</div>
		</div>
		
		<div id="seconds-choice-overlay" class="modal-overlay hidden">
            <div class="modal">
            <h2 class="modal-title modal-title-seconds">⏱️ 秒針能力：</h2>
            <p class="modal-desc">請從剛才選擇的 2 張牌中選擇 1 張</p>
				<div class="modal-actions">
                <button id="seconds-choice-a" class="primary seconds-choice-btn">A</button>
                <button id="seconds-choice-b" class="primary seconds-choice-btn">B</button>
				</div>
            </div>
        </div>	
		
		<div id="collection-overlay" class="modal-overlay hidden">
			<div class="modal">
                <span id="collection-close-btn" class="modal-close-btn">&times;</span>
                <h2 class="modal-title modal-title-collection">已收集小時卡</h2>
                <div id="human-hour-collection" class="hour-collection-list collection-list-scroll">
                    </div>
			</div>
		</div>
		
		<div id="game-over-overlay" class="modal-overlay hidden">
            <div class="modal game-over-modal">
                <h1 id="winner-title" class="game-over-title">遊戲結束</h1>
                <p id="winner-subtitle" class="game-over-subtitle">--</p>
                
                <div class="ranking-header">
                    <span>排名</span>
                    <span>玩家</span>
                    <span>身份</span>
                    <span>得分</span>
                </div>
                <div id="game-over-ranking-list" class="ranking-list">
                    </div>

                <div class="modal-actions game-over-actions">
                    <button id="btn-restart-game" class="primary btn-restart-game">🔄 再玩一局</button>
                    <button id="btn-close-gameover" class="btn-close-gameover">👀 查看盤面</button>
                </div>
            </div>
        </div>
	</div>	
</div>

<script src="config.js"></script>
<script src="logger.js"></script>
<script src="abilities.js"></script>
<script src="game.js"></script>
<script src="ui.js"></script>
</body>
</html>
