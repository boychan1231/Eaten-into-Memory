<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>時魔 2025 - 網頁版</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="game-wrapper">
    <header>
		<div class="tab-nav">
            <button class="tab-btn active" data-target="game-content">遊戲</button>
                <button class="tab-btn" data-target="rules-content">規則</button>
            <button class="tab-btn" data-target="settings-content">設定</button>
        </div>
            
        <div class="game-status">
                <span id="round-info">準備開始</span> | 
                <button id="start-game-btn" style="margin-left: 15px;">開始新遊戲</button>
        </div>
    </header>

    <div class="tab-wrapper">
        <div id="game-content" class="tab-content active-tab">  
            <div class="main-area">
                <div class="log-section">
					<h3>📜 遊戲日誌</h3>
					<div id="game-log-container">
						<ul id="log-list">
						<li>點擊「開始新遊戲」，然後點擊「下一回合」翻開小時卡</li>
						</ul>
					</div>
					<div id="evolution-progress-area" class="progress-area" style="margin: 10px; border: 1px solid #4a3b52; background: #151019;"></div>
				</div>
                <div class="clock-section">
                    <div id="clock-face">
						<svg id="connection-lines" class="connection-lines-svg"></svg>
                        <div class="clock-center"></div>
                    </div>
                </div>

				<div class="side-panel-group">
					<div id="deck-info" class="log-side-info no-click">
						<div class="info-block">
							<div class="deck-title">小時卡庫</div>
							<div class="deck-count" id="deck-count-num">--</div>
						</div>	
						<div class="info-divider"></div>
						<div class="info-block">
							<div class="deck-title">當前回合</div>
							<div class="deck-count" id="round-count-num">--</div>
						</div>
					</div>
					
					<div class="panel-switcher">
						<button id="btn-show-played" class="switch-btn active" type="button">本回合</button>
						<button id="btn-show-history" class="switch-btn" type="button">歷史</button>
						<button id="btn-show-score" class="switch-btn" type="button">積分</button>
					</div>
					
					<div id="played-cards-panel" class="log-side-info">
						<div class="deck-title" style="color:#ffd27f;">本回合出牌</div>
						<div id="played-cards-list"></div>
					</div>
					
					<div id="score-panel" class="log-side-info" style="display:none; min-height: auto;">
						<div class="deck-title" style="color:#ffd27f;">🏆 積分</div>
						<div id="score-list"></div>
					</div>
					
					<div id="player-history-panel" class="log-side-info" style="display:none;">
						<div class="deck-title" style="color:#ffd27f;">各角色出牌記錄</div>
						<div id="player-history-list"></div>
					</div>

				</div>
                
			</div>

                <div id="human-player-area" class="human-area">
                        
                    <div class="human-top-bar">
                        <div class="human-stats-row">
							<h4 id="human-role-display">您是：--</h4>
                            <div>手牌: <span id="h-hand-count">0</span></div>
                            <div>Mana / 齒輪: <span id="h-mana">0</span></div>
                            <div>護盾: <span id="h-dice">--</span></div>
                            <div>位置: <span id="h-pos">--</span></div>
                            <div>收集小時卡: <span id="h-hour">0</span></div>
                        </div>
                    </div>

                    <div class="human-tabs">
                        <div class="human-tab-nav">
                            <button class="human-tab-btn active" data-target="human-tab-hand" type="button">手牌</button>
                            <button class="human-tab-btn" data-target="human-tab-evolution" type="button">小時</button>
                        </div>

                        <div class="human-tab-panels">
                            <div id="human-tab-hand" class="human-tab-panel active">
                                <div class="human-play-row">
                                <div id="human-hand" class="hand-display"></div>
								
                                <div class="info-divider"></div>    
								
                                    <div id="human-controls" class="hand-controls">
                                        <div id="seconds-ability-controls" class="control-block" style="display:none;">
                                            <button id="seconds-ability-btn" type="button">秒針能力：蓋放 2 張</button>
                                            <button id="seconds-ability-cancel-btn" type="button" style="display:none; margin-top:5px;">取消</button>
                                            <div id="seconds-ability-hint" class="instruction-text" style="display:none;">請選擇 2 張卡</div>
                                        </div>

                                        <button id="confirm-move-btn" disabled>確認出牌</button>
                                        <button id="next-step-btn" disabled>下一回合</button>
                                    </div>
                                </div>
                            </div>

                            <div id="human-tab-evolution" class="human-tab-panel">
								<div class="evolution-tab-body" style="display: block;"> <div class="evolution-panel-title">已收集小時卡</div>
									<div id="human-hour-collection" class="hour-collection-list" style="max-height: 200px;"></div>
								</div>
							</div>
                        </div> 
					</div>
				</div> 
				
				<div id="players-section" class="players-grid">
                    <div class="player-card placeholder">
                        <p>等待遊戲開始...</p>
                    </div>
                </div>
				
				

            </div> 
			
			<div id="rules-content" class="tab-content">
                <h3>📜 遊戲規則簡介</h3>

                <h4>🎴 卡牌種類</h4>
                <ul>
                    <li><strong>齒輪卡 (生命/Mana)：</strong>代表角色的生命值與能量上限。歸零時角色將被「驅逐」。</li>
                    <li><strong>分鐘卡 (1-60)：</strong>手牌。數值越大，回合結算時越優先行動。</li>
                    <li><strong>小時卡 (1-12)：</strong>分為少年、青年、中年三種時代。每局依照特定組合在三個時代中分配<strong>「珍貴(★)」</strong>小時卡。</li>
                </ul>

                <h4>🔄 回合流程</h4>
                <ol>
                    <li><strong>抽卡：</strong>每回合抽出 2 張小時卡。</li>
                    <li><strong>出牌：</strong>所有玩家打出 1 張分鐘卡 (數字大者先行動)。</li>
                    <li><strong>移動與收集：</strong>
                        <ul>
                            <li>依順序選擇場上的小時卡，並移動到該數字的位置。</li>
                            <li><strong>幼體時魔：</strong>可將卡片收為己有（用於進化）。</li>
                            <li><strong>其他角色：</strong>卡片將留在此鐘面位置上（堆疊）。</li>
                        </ul>
                    </li>
                    <li><strong>審判 (扣除齒輪)：</strong>結算後，位置最接近 12 (數值最大) 的角色受到懲罰，扣除 1 齒輪。</li>
                </ol>

                <h4>🧬 進化機制 (時魔專屬)</h4>
                <p>幼體時魔收集足夠的小時卡後，可進化為以下強力型態 (三選一)：</p>
                <ul>
                    <li><strong>久遠一生：</strong>3 張不同時代 + 至少 1 張珍貴。</li>
                    <li><strong>命途節錄：</strong>4 張不同數字 + 至少 1 張珍貴。</li>
                    <li><strong>漫長生涯：</strong>5 張任意卡 + 至少 2 張珍貴。</li>
                    <li><strong>刻骨銘記：</strong>3 張珍貴。</li>					
                </ul>

                <h4>⚔ 角色能力</h4>
                <ul>
                    <li><strong>幼體時魔：</strong>
                        <br>🛡️ <strong>防禦：</strong>受罰時，若 Mana ≥ 3，可消耗所有 Mana 抵擋傷害。
                    </li>
                    <li><strong>時之惡 (Boss)：</strong>
                        <br>😈 <strong>主動 2 Mana：</strong>惡之牽引 - 本回合改為懲罰「距離最近」者。
                        <br>🚫 <strong>主動 4 Mana：</strong>時間凍結 - 封印本回合所有時魔能力 (需場上 ≥2 名進化時魔)。
                        <br>⚠️ <strong>飢餓：</strong>若連續 2 輪沒有時魔被逐出，時之惡將自損 1 齒輪。
                    </li>
                    <li><strong>進化 - 時針：</strong>
                        <br>👁️ <strong>被動：</strong>預知牌庫頂的小時卡。
                        <br>⚡ <strong>主動 1 Mana：</strong>將牌庫頂的卡移至底部。
                    </li>
                    <li><strong>進化 - 分針：</strong>
                        <br>⚡ <strong>主動 2 Mana：</strong>取得任意小時卡後，可順/逆時針移動 1 格。
                    </li>
                    <li><strong>進化 - 秒針：</strong>
                        <br>⚡ <strong>主動 3 Mana：</strong>出牌時蓋放 2 張，看過對手出牌後再二選一。
                    </li>
                </ul>

                <h4>🏁 勝負判定</h4>
				<ul>
					<li><strong>受詛者：</strong>遊戲結束時，鐘面上須保留 <strong>12 張</strong> 珍貴小時卡，否則必須落敗（除非觸發「不可能的救贖」）。</li>
					<li><strong>時之惡：</strong>所有時魔皆曾被驅逐，時之惡勝利。</li>	
					<li><strong>不可能的救贖：</strong>時之惡的齒輪耗盡被驅逐時，時魔立即落敗。</li>
					<li><strong>受詛者額外加分：</strong>
						<ul>
							<li>第 2 輪達成 12 張珍貴卡：+9 分</li>
							<li>第 3 輪達成 12 張珍貴卡：+5 分</li>
							<li>第 4 輪達成 12 張珍貴卡：+2 分</li>
						</ul>
					</li>
					<li><strong>計分：</strong>
						<ul>
							<li>主要分數：結束時剩餘齒輪數。</li>
							<li>時魔進化加分：已進化的時魔 (時/分/秒針) 結束時 +3 分。</li>
							<li>受詛者加分：若提早在第 2/ 3/ 4 輪達成 12 張珍貴小時卡目標，分別獲得 <strong>9 / 5 / 2</strong> 分。</li>
						</ul>
					</li>
				</ul>
            </div>
		
		<div id="settings-content" class="tab-content">
		<h3>⚙️ 遊戲設定</h3>
		
		<div class="setting-item">
			<h4>日誌速度</h4>
			<div style="display: flex; align-items: center; gap: 15px;">
				<input type="range" id="log-speed-slider" min="0" max="1000" step="50" value="360" style="flex:1;">
				<span id="log-speed-value" style="font-family: monospace; width: 120px;">360 ms</span>
			</div>
			<p style="font-size: 0.8rem; color: #888;">調整遊戲訊息顯示的快慢。設為 0 可瞬間顯示。</p>
		</div>

		<hr style="border-color: #333; margin: 20px 0;">

		<div class="setting-item">
			<h3>設定選項</h3>
			
			<label class="toggle-switch" style="margin-bottom: 15px;">
				<input type="checkbox" id="ability-toggle" checked>
				<span class="slider"></span>
				<span>啟用特殊能力 span>
			</label>

			<label class="toggle-switch">
				<input type="checkbox" id="test-toggle">
				<span class="slider"></span>
				<span>測試模式</span>
			</label>
			    <div class="setting-hint">
                開啟後人類玩家第 1 輪起始手牌固定為 1,2,3,4,5,12,36,56,57,58,59,60。其他角色照常隨機分配（會先從牌庫移除上述卡）。
                </div>
		</div>

		<hr style="border-color: #333; margin: 20px 0;">

			<div class="setting-item">
				<h4>除錯資訊</h4>
				<p style="font-size: 0.8rem; color: #666;">
					Build Ver: 2025.01.27<br>
					Core: game.js / UI: ui.js
					2026 01 14：鐘面回合數指示浮標變成指示玩家位置
				</p>
			</div>
	</div>
			
		<div id="role-choice-overlay" class="modal-overlay" style="display:none;">
			<div class="modal">
			<h2>選擇角色</h2>
				<div class="modal-actions">
				<button id="role-choice-timeDemon" class="primary" type="button">時魔</button>
				<button id="role-choice-sin" type="button">時之惡</button>
				<button id="role-choice-scz" type="button">受詛者</button>
				</div>
			</div>
		</div>
		
		<div id="seconds-choice-overlay" class="modal-overlay" style="display:none;">
            <div class="modal">
            <h2 class="modal-title" style="color:#00d2d3;">⏱️ 秒針能力：命運抉擇</h2>
            <p class="modal-desc">您已看過所有對手的出牌。<br>現在，請從剛才蓋放的 2 張牌中，選擇 1 張打出。</p>
				<div class="modal-actions">
                <button id="seconds-choice-a" class="primary" style="font-size:1.5rem; font-weight:bold;">A</button>
                <button id="seconds-choice-b" class="primary" style="font-size:1.5rem; font-weight:bold;">B</button>
				</div>
            </div>
        </div>	
	</div>	
</div>

<script src="config.js"></script>
<script src="abilities.js"></script>
<script src="game.js"></script>
<script src="ui.js"></script>
</body>
</html>